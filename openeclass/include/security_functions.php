<?php

function getXSSToken() {
    $nonce = $_SESSION['uid'].sha1(rand()+3);
    return $nonce;
}

function getCSRFToken() {
    $nonce = $_SESSION['uid'].sha1(rand()+2);

    if (empty($_SESSION['csrf_tokens'])) {
        $_SESSION['csrf_tokens'] = array();
    }
    $_SESSION['csrf_tokens'][$nonce] = true;
    return $nonce;
}


function validateCSRFToken($token) {
    if (isset($_SESSION['csrf_tokens'][$token])) {
        unset($_SESSION['csrf_tokens'][$token]);
        return true;
    }
    return false;
}

function validateCSRFTokenOrDie() {
  //Validate Form
  $token = isset($_POST['csrf_token']) ? $_POST['csrf_token'] : '';
  $valid = !empty($token) && validateCSRFToken($token);
  if (!$valid) {
    echo "Goin' somewhere bro?";
    exit();
  }
  return true;
}

